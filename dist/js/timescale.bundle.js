(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{16:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var d3_selection__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8),d3_scale__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12),d3_transition__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13),d3_hierarchy__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14),d3_fetch__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(15),d3_ease__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11);const timescale=function(){function searchTree(t,e,_){if(t.data[e]===_)return t;if(null!=t.children){let a=null;for(let n=0;null==a&&n<t.children.length;n+=1)a=searchTree(t.children[n],e,_);return a}return null}d3_selection__WEBPACK_IMPORTED_MODULE_0__.e.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};let width=window.innerWidth-4;const height=130,data={oid:0,nam:"Geologic Time",children:[]},interval_hash={0:data};let currentInterval,root;return{init(t){Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#${t}`).attr("class","timescale");const e=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#${t}`).append("svg").attr("width",width).attr("height",height+20).append("g"),_=e.append("g").attr("id","tickBar").attr("transform",`translate(0,${height-5})`),a=Object(d3_hierarchy__WEBPACK_IMPORTED_MODULE_3__.b)().size([width,height]).padding(0);Object(d3_fetch__WEBPACK_IMPORTED_MODULE_4__.a)("jsons/intervals.json").then(t=>{t.records.forEach(t=>{t.children=[],t.pid=t.pid||0,t.abr=t.abr||t.nam.charAt(0),t.mid=parseInt((t.eag+t.lag)/2),t.total=t.eag-t.lag,interval_hash[t.oid]=t,interval_hash[t.pid].children.push(t)}),root=Object(d3_hierarchy__WEBPACK_IMPORTED_MODULE_3__.a)(data).sum(t=>0===t.children.length?t.total+.117:0),a(root),e.append("g").attr("id","rectGroup").selectAll("rect").data(root.descendants()).enter().append("rect").attr("x",t=>t.x0).attr("y",t=>t.y0).attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t.data.col||"#000").attr("id",t=>`t${t.data.oid}`).style("opacity",.83).on("click",t=>{timescale.goTo(t)});const n=_.selectAll("rect").data(root.descendants()).enter().append("g").attr("class",t=>`tickGroup s${t.data.lvl}`).attr("transform",t=>`translate(${t.x0}, 0)`);n.append("line").attr("x1",0).attr("y1",6).attr("x2",0).attr("y2",12).style("stroke-width","0.05em"),n.append("text").attr("x",0).attr("y",20).style("text-anchor",t=>.0117!==t.data.eag?"middle":"end").style("font-size","0.65em").style("fill","#000").text(t=>t.data.eag);const r=_.append("g").data([{x0:width,y0:0}]).attr("class","tickGroup s1 s2 s3 s4 s5").attr("transform",`translate(${width}, 0)`);r.append("line").attr("x1",0).attr("y1",6).attr("x2",0).attr("y2",12).style("stroke-width","0.05em"),r.append("text").attr("x",0).attr("y",20).attr("id","now").style("fill","white").style("text-anchor","end").style("font-size","0.65em").style("fill","#777").text("0");const d=e.append("g").attr("id","textGroup");d.selectAll("fullName").data(root.descendants()).enter().append("text").text(t=>t.data.nam).attr("x",1).attr("y",t=>t.y0+15).attr("width",function(){return this.getComputedTextLength()}).attr("height",t=>t.y1-t.y0).attr("class",t=>`fullName level${t.data.lvl}`).attr("id",t=>`l${t.data.oid}`).attr("x",t=>timescale.labelX(t)).on("click",t=>{timescale.goTo(t)}),d.selectAll("abbrevs").data(root.descendants()).enter().append("text").attr("x",1).attr("y",t=>t.y0+15).attr("width",30).attr("height",t=>t.y1-t.y0).text(t=>t.data.abr).attr("class",t=>`abbr level${t.data.lvl}`).attr("id",t=>`a${t.data.oid}`).attr("x",t=>timescale.labelAbbrX(t)).on("click",t=>{timescale.goTo(t)}),timescale.goTo(root),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(".abbr.levelundefined").remove(),timescale.goTo("Phanerozoïcum"),timescale.currentInterval=searchTree(root,"nam","Phanerozoïcum")}),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(window).on("resize",timescale.resize)},labelAbbrX(t){const e=parseFloat(Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#t${t.data.oid}`).attr("width")),_=parseFloat(Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#t${t.data.oid}`).attr("x")),a=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).node().getComputedTextLength();return e-8<a&&Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).style("display","none"),_+(e-a)/2},labelX(t){const e=t.x1-t.x0,_=t.x0;let a;try{a=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#l${t.data.oid}`).node().getComputedTextLength()}catch(t){a=25}return e-10<a?Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#l${t.data.oid}`).style("display","none"):Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).style("display","none"),_+(e-a)/2},goTo(d){if("string"==typeof d)d=searchTree(root,"nam",d);else if(d.children&&d.children.length<1){const t=t.data.parent}timescale.currentInterval=d,Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".fullName").style("display","block"),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").style("display","block");const depth="undefined"!==d.depth?parseInt(d.depth)+1:1;Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".scale").style("display","none"),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".tickGroup").style("display","none"),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(`.s${depth}`).style("display","block");const x=Object(d3_scale__WEBPACK_IMPORTED_MODULE_1__.a)().range([5,width]).domain([d.x0,d.x1]),t=Object(d3_transition__WEBPACK_IMPORTED_MODULE_2__.a)().duration(300).ease(d3_ease__WEBPACK_IMPORTED_MODULE_5__.b);if(Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)("rect").transition(t).attr("x",t=>x(t.x0)).attr("width",t=>x(t.x1)-x(t.x0)),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".tickGroup").transition(t).attr("transform",function(t){if(Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(this).selectAll("text").style("text-anchor","middle"),5===x(t.x0)?Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(this).select("text").style("text-anchor","start"):t.x0===width&&Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(this).select("text").style("text-anchor","end"),"number"==typeof x(t.x0))return`translate(${x(t.x0)}, 0)`}),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".fullName").transition(t).attr("x",t=>{const e=x(t.x1)-x(t.x0),_=x(t.x0);let a;try{a=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#l${t.data.oid}`).node().getComputedTextLength()}catch(t){a=25}return e-8<a?Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#l${t.data.oid}`).style("display","none"):Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).style("display","none"),_+(e-a)/2}).attr("height",t=>t.y1-t.y0),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").transition(t).attr("x",t=>{const e=x(t.x1)-x(t.x0),_=x(t.x0),a=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).node().getComputedTextLength();return e-8<a&&Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#a${t.data.oid}`).style("display","none"),_+(e-a)/2}).attr("height",t=>t.y1-t.y0).on("end",()=>{Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".fullName").style("fill","#333"),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").style("fill","#333")}),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(`#l${d.data.oid}`).transition(t).attr("x",width/2),null!==d.parent){const{depth:depth}=d;let loc="d.parent";for(let i=0;i<depth;i+=1){const parent=eval(loc).data.nam;Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").filter(t=>t.data.nam===parent).transition(t).attr("x",width/2),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".fullName").filter(t=>t.data.nam===parent).transition(t).attr("x",width/2),loc+=".parent"}Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").filter(t=>t.data.nam===parent).transition(t).attr("x",width/2),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".fullName").filter(t=>t.data.nam===parent).transition(t).attr("x",width/2)}},highlight(t){if(Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)("rect").style("stroke","#fff"),t.cxi){t.cxi;Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(`rect#t${t.cxi}`).style("stroke","#000").moveToFront(),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(`#l${t.cxi}`).moveToFront()}else if("string"==typeof t){let e=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)("rect").filter(e=>e.nam===t).attr("id");e=e.replace("t","")}else{let e=Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(t).attr("id");e=e.replace("p","")}Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(`rect#t${id}`).style("stroke","#000").moveToFront(),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(`#l${id}`).moveToFront(),Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)(".abbr").moveToFront()},unhighlight(){Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.d)("rect").style("stroke","#fff")},resize(){width=window.innerWidth-4,Object(d3_selection__WEBPACK_IMPORTED_MODULE_0__.c)(".timescale svg").style("width",width),setTimeout(()=>{timescale.goTo(timescale.currentInterval.data.nam)},600)},interval_hash:interval_hash,currentInterval:currentInterval}}();__webpack_exports__.default=timescale}}]);
//# sourceMappingURL=timescale.bundle.js.map